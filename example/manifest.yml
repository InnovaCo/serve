info:
  name: forgame-test
  description: 4game Test
  version: "2.1"
  category: facade
  owner:
    name: Dmitry Kulikov
    email: kulikov.dm@gmail.com

build:
  - sh: "mkdir -p target/pack && touch target/pack/index.txt"
  - sbt-pack: {}
  - sh: "echo 'Hello, World!'"
  - debian:
      daemon: "$APPLICATION_PATH/bin/start"
      daemon-args: "--port=$PORT1 --env=${ENV_NAME}"
      daemon-port: 9040

upload:
  - debian: {}
  - marathon: {}

test: &some_test
  hello: a {{ vars.hello }}
  name: Dima
  new ? {{ vars.env }}:
    qa: Dima-Qa
    live: Dima-Live
    dev: Dima-Dev

deploy:
  - marathon:
      instances: 3
      mem: 512
      cpu: 1
      cmd: "bin/mesos-start"
      constraints: "kidz:true"

  - debian:
      cluster ? {{ vars.env }}:
        qa: cpb-new.qa.inn.ru
        live: cpb.lux.inn.eu

release:
  routes:
    - host ? {{vars.branch}}-{{vars.env}}:
        "-live": "~^(.+\\.)?kidzite.space$;"
        "-qa": "~^(.+\\.)?kidzite.qa$;"
        "*": "{{vars.branch}}.kidzite.qa"
      location: /

result:
  << : *some_test
  surname: kulikov
  name: Misha
